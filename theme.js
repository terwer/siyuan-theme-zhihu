"use strict";var te=Object.defineProperty;var re=(r,e,t)=>e in r?te(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var G=(r,e,t)=>(re(r,typeof e!="symbol"?e+"":e,t),t);class ne{hello(){console.log("Hello World")}}class oe{constructor(){G(this,"hello");this.hello=new ne}async init(e){this.hello.hello()}}const w={};var ie=Object.defineProperty,se=(r,e,t)=>e in r?ie(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,p=(r,e,t)=>(se(r,typeof e!="symbol"?e+"":e,t),t),le=Object.defineProperty,ae=(r,e,t)=>e in r?le(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,b=(r,e,t)=>(ae(r,typeof e!="symbol"?e+"":e,t),t),X=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},O={},ce={get exports(){return O},set exports(r){O=r}};(function(r){(function(e,t){r.exports?r.exports=t():e.log=t()})(X,function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"];function i(c,y){var S=c[y];if(typeof S.bind=="function")return S.bind(c);try{return Function.prototype.bind.call(S,c)}catch{return function(){return Function.prototype.apply.apply(S,[c,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(c){return c==="debug"&&(c="log"),typeof console===t?!1:c==="trace"&&n?l:console[c]!==void 0?i(console,c):console.log!==void 0?i(console,"log"):e}function u(c,y){for(var S=0;S<o.length;S++){var h=o[S];this[h]=S<c?e:this.methodFactory(h,c,y)}this.log=this.debug}function d(c,y,S){return function(){typeof console!==t&&(u.call(this,y,S),this[c].apply(this,arguments))}}function a(c,y,S){return s(c)||d.apply(this,arguments)}function E(c,y,S){var h=this,D;y=y??"WARN";var v="loglevel";typeof c=="string"?v+=":"+c:typeof c=="symbol"&&(v=void 0);function C(g){var L=(o[g]||"silent").toUpperCase();if(!(typeof window===t||!v)){try{window.localStorage[v]=L;return}catch{}try{window.document.cookie=encodeURIComponent(v)+"="+L+";"}catch{}}}function U(){var g;if(!(typeof window===t||!v)){try{g=window.localStorage[v]}catch{}if(typeof g===t)try{var L=window.document.cookie,I=L.indexOf(encodeURIComponent(v)+"=");I!==-1&&(g=/^([^;]+)/.exec(L.slice(I))[1])}catch{}return h.levels[g]===void 0&&(g=void 0),g}}function x(){if(!(typeof window===t||!v)){try{window.localStorage.removeItem(v);return}catch{}try{window.document.cookie=encodeURIComponent(v)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}h.name=c,h.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},h.methodFactory=S||a,h.getLevel=function(){return D},h.setLevel=function(g,L){if(typeof g=="string"&&h.levels[g.toUpperCase()]!==void 0&&(g=h.levels[g.toUpperCase()]),typeof g=="number"&&g>=0&&g<=h.levels.SILENT){if(D=g,L!==!1&&C(g),u.call(h,g,c),typeof console===t&&g<h.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+g},h.setDefaultLevel=function(g){y=g,U()||h.setLevel(g,!1)},h.resetLevel=function(){h.setLevel(y,!1),x()},h.enableAll=function(g){h.setLevel(h.levels.TRACE,g)},h.disableAll=function(g){h.setLevel(h.levels.SILENT,g)};var _=U();_==null&&(_=y),h.setLevel(_,!1)}var f=new E,m={};f.getLogger=function(c){if(typeof c!="symbol"&&typeof c!="string"||c==="")throw new TypeError("You must supply a name when creating a logger.");var y=m[c];return y||(y=m[c]=new E(c,f.getLevel(),f.methodFactory)),y};var V=typeof window!==t?window.log:void 0;return f.noConflict=function(){return typeof window!==t&&window.log===f&&(window.log=V),f},f.getLoggers=function(){return m},f.default=f,f})})(ce);var R={},ue={get exports(){return R},set exports(r){R=r}};(function(r){(function(e,t){r.exports?r.exports=t():e.prefix=t(e)})(X,function(e){var t=function(a){for(var E=1,f=arguments.length,m;E<f;E++)for(m in arguments[E])Object.prototype.hasOwnProperty.call(arguments[E],m)&&(a[m]=arguments[E][m]);return a},n={template:"[%t] %l:",levelFormatter:function(a){return a.toUpperCase()},nameFormatter:function(a){return a||"root"},timestampFormatter:function(a){return a.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},format:void 0},o,i={},l=function(a){if(!a||!a.getLogger)throw new TypeError("Argument is not a root logger");o=a},s=function(a,E){if(!a||!a.setLevel)throw new TypeError("Argument is not a logger");var f=a.methodFactory,m=a.name||"",V=i[m]||i[""]||n;function c(y,S,h){var D=f(y,S,h),v=i[h]||i[""],C=v.template.indexOf("%t")!==-1,U=v.template.indexOf("%l")!==-1,x=v.template.indexOf("%n")!==-1;return function(){for(var _="",g=arguments.length,L=Array(g),I=0;I<g;I++)L[I]=arguments[I];if(m||!i[h]){var j=v.timestampFormatter(new Date),W=v.levelFormatter(y),z=v.nameFormatter(h);v.format?_+=v.format(W,z,j):(_+=v.template,C&&(_=_.replace(/%t/,j)),U&&(_=_.replace(/%l/,W)),x&&(_=_.replace(/%n/,z))),L.length&&typeof L[0]=="string"?L[0]=_+" "+L[0]:L.unshift(_)}D.apply(void 0,L)}}return i[m]||(a.methodFactory=c),E=E||{},E.template&&(E.format=void 0),i[m]=t({},V,E),a.setLevel(a.getLevel()),o||a.warn("It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md"),a},u={reg:l,apply:s},d;return e&&(d=e.prefix,u.noConflict=function(){return e.prefix===u&&(e.prefix=d),u}),u})})(ue);class F{}b(F,"LOG_LEVEL_KEY","VITE_LOG_LEVEL"),b(F,"LOG_PREFIX_KEY","VITE_LOG_PREFIX");var T=(r=>(r.LOG_LEVEL_DEBUG="DEBUG",r.LOG_LEVEL_INFO="INFO",r.LOG_LEVEL_WARN="WARN",r.LOG_LEVEL_ERROR="ERROR",r))(T||{});function ge(){const r=Error.prepareStackTrace;Error.prepareStackTrace=(t,n)=>n;const e=new Error().stack.slice(1);return Error.prepareStackTrace=r,e}class k{static stringToEnumValue(e,t){return e[Object.keys(e).filter(n=>e[n].toString()===t)[0]]}static getEnvLevel(e){if(!e)return;const t=e.getEnvOrDefault(F.LOG_LEVEL_KEY,T.LOG_LEVEL_INFO),n=k.stringToEnumValue(T,t.toUpperCase());return n||console.warn("[zhi-log] LOG_LEVEL is invalid in you .env file.Must be either debug, info, warn or error, fallback to default info level"),n}static getEnvLogger(e){if(e)return e.getEnv(F.LOG_PREFIX_KEY)}}class he{constructor(e,t,n){b(this,"consoleLogger","console"),b(this,"stackSize",1),b(this,"getLogger",l=>{let s;if(l)s=l;else{const u=ge(),d=[];for(let a=0;a<u.length;a++){const E=u[a],f=E.getFileName()??"none";if(!f.includes(".ts")&&!f.includes(".js")&&!f.includes(".cjs")&&!f.includes(".mjs")&&!f.includes(".vue")&&!f.includes(".tsx"))continue;if(a>this.stackSize-1)break;const m=f+"-"+E.getLineNumber()+":"+E.getColumnNumber();d.push(m)}u.length>0&&(s=d.join(" -> "))}return(!s||s.trim().length===0)&&(s=this.consoleLogger),O.getLogger(s)}),this.stackSize=1;let o;e?o=e:o=k.getEnvLevel(n),o=o??T.LOG_LEVEL_INFO,O.setLevel(o);const i={gray:l=>l.toString(),green:l=>l.toString(),yellow:l=>l.toString(),red:l=>l.toString()};R.reg(O),R.apply(O,{format(l,s,u){const d=["["+(t??k.getEnvLogger(n)??"zhi")+"]"];switch(d.push(i.gray("[")+i.green(u).toString()+i.gray("]")),l){case T.LOG_LEVEL_DEBUG:d.push(i.gray(l.toUpperCase().toString()));break;case T.LOG_LEVEL_INFO:d.push(i.green(l.toUpperCase().toString()));break;case T.LOG_LEVEL_WARN:d.push(i.yellow(l.toUpperCase().toString()));break;case T.LOG_LEVEL_ERROR:d.push(i.red(l.toUpperCase().toString()));break}return d.push(i.green(s).toString()),d.push(i.gray(":")),d.join(" ")}})}setStackSize(e){this.stackSize=e??1}}class pe{constructor(e,t,n){b(this,"logger"),this.logger=new he(e,t,n)}getLogger(e,t){return this.logger.setStackSize(t),this.logger.getLogger(e)}}class B extends pe{constructor(e,t,n){super(e,t,n)}getLogger(e,t){return super.getLogger(e,t)}}class M{static defaultLogger(e,t){return M.customLogFactory(void 0,void 0,e).getLogger(void 0,t)}static customLogFactory(e,t,n){return new B(e,t,n)}static customSignLogFactory(e,t){return new B(void 0,e,t)}}class q{}p(q,"LOG_STACK_SIZE",1);class de{constructor(){p(this,"VERSION"),this.VERSION="1.0.0"}}class fe{constructor(){p(this,"VERSION"),this.VERSION="1.0.0"}}const J=class{static isInChromeExtension(){return J.isInBrowser?window.location.href.indexOf("chrome-extension://")>-1:!1}};let A=J;p(A,"isInBrowser",typeof window<"u");class Q{constructor(){p(this,"isInSiyuanOrSiyuanNewWin",()=>A.isInBrowser),p(this,"isInSiyuanWidget",()=>window.frameElement!=null&&window.frameElement.parentElement!=null&&window.frameElement.parentElement.parentElement!=null&&window.frameElement.parentElement.parentElement.getAttribute("data-node-id")!==""),p(this,"isInSiyuanNewWin",()=>typeof window.terwer<"u"),p(this,"requireLib",e=>{const t=this.syWin();if(!this.syWin())throw new Error("Not in siyuan env");return t.require(e)}),p(this,"getCrossPlatformAppDataFolder",()=>{var e,t,n,o,i,l;let s;return((e=this.syProcess())==null?void 0:e.platform)==="darwin"?s=w.join((t=this.syProcess())==null?void 0:t.env.HOME,"/Library/Application Support"):((n=this.syProcess())==null?void 0:n.platform)==="win32"?s=(o=this.syProcess())==null?void 0:o.env.APPDATA:((i=this.syProcess())==null?void 0:i.platform)==="linux"&&(s=(l=this.syProcess())==null?void 0:l.env.HOME),s})}syWin(){let e;return this.isInSiyuanWidget()?e=parent.window:(this.isInSiyuanNewWin()&&(e=window),e=window),e??void 0}syProcess(){return A.isInBrowser?window.process:process}SIYUAN_CONF_PATH(){var e;if(!this.syWin())throw new Error("Not in siyuan env");return(e=this.syWin())==null?void 0:e.siyuan.config.system.confDir}SIYUAN_DATA_PATH(){var e;if(!this.syWin())throw new Error("Not in siyuan env");return(e=this.syWin())==null?void 0:e.siyuan.config.system.dataDir}SIYUAN_APPEARANCE_PATH(){return w.join(this.SIYUAN_CONF_PATH(),"appearance")}SIYUAN_THEME_PATH(){return w.join(this.SIYUAN_APPEARANCE_PATH(),"themes")}ZHI_THEME_PATH(){return w.join(this.SIYUAN_THEME_PATH(),"zhi")}ZHI_THEME_DIST_PATH(){return w.join(this.ZHI_THEME_PATH(),"apps","theme","dist")}ZHI_BLOG_DIST_PATH(){return w.join(this.SIYUAN_THEME_PATH(),"apps","blog","dist")}}class Ee{constructor(){p(this,"serverApi"),p(this,"clientApi"),p(this,"siyuanUtil"),this.serverApi=new de,this.clientApi=new fe,this.siyuanUtil=new Q}}class ve{constructor(){p(this,"VERSION"),this.VERSION="1.0.0"}}class we{f(e,...t){let n=e;for(let o=0;o<t.length;o++){const i=t[o];typeof i=="string"?n=n.replace(`{${o}}`,i):n=n.replace(`{${o}}`,i.toString())}return n}}class ye{copyFolderSync(e,t){const n=this;w.existsSync(t)||w.mkdirSync(t),w.lstatSync(e).isDirectory()&&w.readdirSync(e).forEach(function(o){const i=w.join(e,o);w.lstatSync(i).isDirectory()?n.copyFolderSync(i,w.join(t,o)):w.copyFileSync(i,w.join(t,o))})}rmFolder(e){w.existsSync(e)&&w.rmdirSync(e,{recursive:!0})}joinPath(...e){return w.join(...e)}dirname(e){return w.dirname(e)}absPath(e){const t=this.dirname(e);return w.resolve(w.dirname(t),e)}}class me{constructor(){p(this,"TIME_SPLIT"," "),p(this,"formatIsoToZhDate",(e,t,n)=>{if(!e)return"";let o=e;const i=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(.\d{3})Z$/gm,l=o.match(i);if(l==null)return e;for(let s=0;s<l.length;s++){const u=l[s];let d=u;t&&(d=this.addHoursToDate(new Date(u),8).toISOString());const a=d.split("T"),E=a[0],f=a[1].split(".")[0];let m=E+this.TIME_SPLIT+f;n&&(m=E),o=o.replace(u,m)}return o})}addHoursToDate(e,t){return e.setTime(e.getTime()+t*60*60*1e3),e}nowZh(){return this.formatIsoToZhDate(new Date().toISOString())}nowDateZh(){return this.formatIsoToZhDate(new Date().toISOString(),!0,!0)}nowTimeZh(){return this.formatIsoToZhDate(new Date().toISOString(),!0).split(this.TIME_SPLIT)[1]}}const H=(r,e)=>{const t=Y(r),n=Y(e),o=t.pop(),i=n.pop(),l=$(t,n);return l!==0?l:o&&i?$(o.split("."),i.split(".")):o||i?o?-1:1:0},Se=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Y=r=>{if(typeof r!="string")throw new TypeError("Invalid argument expected string");const e=r.match(Se);if(!e)throw new Error(`Invalid argument not valid semver ('${r}' received)`);return e.shift(),e},Z=r=>r==="*"||r==="x"||r==="X",K=r=>{const e=parseInt(r,10);return isNaN(e)?r:e},Le=(r,e)=>typeof r!=typeof e?[String(r),String(e)]:[r,e],_e=(r,e)=>{if(Z(r)||Z(e))return 0;const[t,n]=Le(K(r),K(e));return t>n?1:t<n?-1:0},$=(r,e)=>{for(let t=0;t<Math.max(r.length,e.length);t++){const n=_e(r[t]||"0",e[t]||"0");if(n!==0)return n}return 0};class Te{greater(e,t){return H(e,t)>0}equal(e,t){return H(e,t)===0}lesser(e,t){return H(e,t)<0}}class Ie{static getDevice(){const e=new Q;return e.isInSiyuanWidget()?"Siyuan_Widget":e.isInSiyuanOrSiyuanNewWin()?"Siyuan_NewWin":A.isInChromeExtension()?"Chrome_Extension":"Chrome_Browser"}}class Oe{constructor(){p(this,"strUtil"),p(this,"dateUtil"),p(this,"nodeUtil"),p(this,"browserUtil"),p(this,"versionUtil"),p(this,"deviceUtil"),this.strUtil=new we,this.dateUtil=new me,this.nodeUtil=new ye,this.browserUtil=A,this.versionUtil=new Te,this.deviceUtil=Ie}}class be{constructor(e){p(this,"env"),p(this,"logger"),p(this,"siyuanApi"),p(this,"blogApi"),p(this,"common"),this.env=e,this.logger=M.defaultLogger(this.env,q.LOG_STACK_SIZE),this.siyuanApi=new Ee,this.blogApi=new ve,this.common=new Oe}getEnv(){if(!this.env)throw new Error("env is not initiated, please use new ZhiSdk(env) create ZhiSdk object!");return this.env}getLogger(){return this.logger}}function Ne(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ee={};(function(r){var e=Object.defineProperty,t=(l,s,u)=>s in l?e(l,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[s]=u,n=(l,s,u)=>(t(l,typeof s!="symbol"?s+"":s,u),u);Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});class o{}n(o,"NODE_ENV_KEY","NODE_ENV"),n(o,"VITE_DEBUG_MODE_KEY","VITE_DEBUG_MODE");class i{constructor(s){n(this,"envMeta"),this.envMeta=s}isNodeDev(){return this.getEnv(o.NODE_ENV_KEY)==="development"}isDev(){return this.isNodeDev()||this.getBooleanEnv(o.VITE_DEBUG_MODE_KEY)}getEnv(s){let u;try{this.envMeta[s]&&(u=this.envMeta[s])}catch(d){console.error(d)}return u}getStringEnv(s){return this.getEnv(s)??""}getBooleanEnv(s){let u=!1;return this.getEnv(s)&&(u=this.getStringEnv(s).toLowerCase()==="true"),u}getEnvOrDefault(s,u){const d=this.getStringEnv(s);return d.trim().length==0?u:d}}r.EnvConstants=o,r.default=i})(ee);const Ae=Ne(ee),N=class{static zhiSdk(){if(!N.zhiSdkObj){const e=new Ae({VITE_LOG_LEVEL:"DEBUG",VITE_DEBUG_MODE:"true",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1});N.zhiSdkObj=new be(e)}return N.zhiSdkObj}};let P=N;G(P,"zhiSdkObj");function De(){const r=Error.prepareStackTrace;Error.prepareStackTrace=(t,n)=>n;const e=new Error().stack.slice(1);return Error.prepareStackTrace=r,e}(async()=>{const r=P.zhiSdk(),e=r.getLogger(),t=r.getEnv(),n=async()=>{e.info("Theme is loading..."),await new oe().init("electron"),e.info("Theme loaded.")};if(t.isDev()){const o=De(),i="theme.js";(o.length>0?o[0].getFileName()??i:i).includes(i)?await import("http://localhost:5173/theme.ts"):await n()}else await n()})();
