"use strict";var te=Object.defineProperty;var ne=(n,e,t)=>e in n?te(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var G=(n,e,t)=>(ne(n,typeof e!="symbol"?e+"":e,t),t);class re{hello(){console.log("Hello World23")}}class oe{constructor(){G(this,"hello");this.hello=new re}async init(e){this.hello.hello()}}const w={};var ie=Object.defineProperty,se=(n,e,t)=>e in n?ie(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,p=(n,e,t)=>(se(n,typeof e!="symbol"?e+"":e,t),t),le=Object.defineProperty,ae=(n,e,t)=>e in n?le(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,N=(n,e,t)=>(ae(n,typeof e!="symbol"?e+"":e,t),t),X=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},b={},ce={get exports(){return b},set exports(n){b=n}};(function(n){(function(e,t){n.exports?n.exports=t():e.log=t()})(X,function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"];function s(c,y){var S=c[y];if(typeof S.bind=="function")return S.bind(c);try{return Function.prototype.bind.call(S,c)}catch{return function(){return Function.prototype.apply.apply(S,[c,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function i(c){return c==="debug"&&(c="log"),typeof console===t?!1:c==="trace"&&r?l:console[c]!==void 0?s(console,c):console.log!==void 0?s(console,"log"):e}function u(c,y){for(var S=0;S<o.length;S++){var h=o[S];this[h]=S<c?e:this.methodFactory(h,c,y)}this.log=this.debug}function d(c,y,S){return function(){typeof console!==t&&(u.call(this,y,S),this[c].apply(this,arguments))}}function a(c,y,S){return i(c)||d.apply(this,arguments)}function E(c,y,S){var h=this,D;y=y??"WARN";var v="loglevel";typeof c=="string"?v+=":"+c:typeof c=="symbol"&&(v=void 0);function x(g){var L=(o[g]||"silent").toUpperCase();if(!(typeof window===t||!v)){try{window.localStorage[v]=L;return}catch{}try{window.document.cookie=encodeURIComponent(v)+"="+L+";"}catch{}}}function U(){var g;if(!(typeof window===t||!v)){try{g=window.localStorage[v]}catch{}if(typeof g===t)try{var L=window.document.cookie,O=L.indexOf(encodeURIComponent(v)+"=");O!==-1&&(g=/^([^;]+)/.exec(L.slice(O))[1])}catch{}return h.levels[g]===void 0&&(g=void 0),g}}function C(){if(!(typeof window===t||!v)){try{window.localStorage.removeItem(v);return}catch{}try{window.document.cookie=encodeURIComponent(v)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}h.name=c,h.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},h.methodFactory=S||a,h.getLevel=function(){return D},h.setLevel=function(g,L){if(typeof g=="string"&&h.levels[g.toUpperCase()]!==void 0&&(g=h.levels[g.toUpperCase()]),typeof g=="number"&&g>=0&&g<=h.levels.SILENT){if(D=g,L!==!1&&x(g),u.call(h,g,c),typeof console===t&&g<h.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+g},h.setDefaultLevel=function(g){y=g,U()||h.setLevel(g,!1)},h.resetLevel=function(){h.setLevel(y,!1),C()},h.enableAll=function(g){h.setLevel(h.levels.TRACE,g)},h.disableAll=function(g){h.setLevel(h.levels.SILENT,g)};var _=U();_==null&&(_=y),h.setLevel(_,!1)}var f=new E,m={};f.getLogger=function(c){if(typeof c!="symbol"&&typeof c!="string"||c==="")throw new TypeError("You must supply a name when creating a logger.");var y=m[c];return y||(y=m[c]=new E(c,f.getLevel(),f.methodFactory)),y};var k=typeof window!==t?window.log:void 0;return f.noConflict=function(){return typeof window!==t&&window.log===f&&(window.log=k),f},f.getLoggers=function(){return m},f.default=f,f})})(ce);var R={},ue={get exports(){return R},set exports(n){R=n}};(function(n){(function(e,t){n.exports?n.exports=t():e.prefix=t(e)})(X,function(e){var t=function(a){for(var E=1,f=arguments.length,m;E<f;E++)for(m in arguments[E])Object.prototype.hasOwnProperty.call(arguments[E],m)&&(a[m]=arguments[E][m]);return a},r={template:"[%t] %l:",levelFormatter:function(a){return a.toUpperCase()},nameFormatter:function(a){return a||"root"},timestampFormatter:function(a){return a.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},format:void 0},o,s={},l=function(a){if(!a||!a.getLogger)throw new TypeError("Argument is not a root logger");o=a},i=function(a,E){if(!a||!a.setLevel)throw new TypeError("Argument is not a logger");var f=a.methodFactory,m=a.name||"",k=s[m]||s[""]||r;function c(y,S,h){var D=f(y,S,h),v=s[h]||s[""],x=v.template.indexOf("%t")!==-1,U=v.template.indexOf("%l")!==-1,C=v.template.indexOf("%n")!==-1;return function(){for(var _="",g=arguments.length,L=Array(g),O=0;O<g;O++)L[O]=arguments[O];if(m||!s[h]){var M=v.timestampFormatter(new Date),z=v.levelFormatter(y),W=v.nameFormatter(h);v.format?_+=v.format(z,W,M):(_+=v.template,x&&(_=_.replace(/%t/,M)),U&&(_=_.replace(/%l/,z)),C&&(_=_.replace(/%n/,W))),L.length&&typeof L[0]=="string"?L[0]=_+" "+L[0]:L.unshift(_)}D.apply(void 0,L)}}return s[m]||(a.methodFactory=c),E=E||{},E.template&&(E.format=void 0),s[m]=t({},k,E),a.setLevel(a.getLevel()),o||a.warn("It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md"),a},u={reg:l,apply:i},d;return e&&(d=e.prefix,u.noConflict=function(){return e.prefix===u&&(e.prefix=d),u}),u})})(ue);class V{}N(V,"LOG_LEVEL_KEY","VITE_LOG_LEVEL"),N(V,"LOG_PREFIX_KEY","VITE_LOG_PREFIX");var I=(n=>(n.LOG_LEVEL_DEBUG="DEBUG",n.LOG_LEVEL_INFO="INFO",n.LOG_LEVEL_WARN="WARN",n.LOG_LEVEL_ERROR="ERROR",n))(I||{});function ge(){const n=Error.prepareStackTrace;Error.prepareStackTrace=(t,r)=>r;const e=new Error().stack.slice(1);return Error.prepareStackTrace=n,e}class F{static stringToEnumValue(e,t){return e[Object.keys(e).filter(r=>e[r].toString()===t)[0]]}static getEnvLevel(e){if(!e)return;const t=e.getEnvOrDefault(V.LOG_LEVEL_KEY,I.LOG_LEVEL_INFO),r=F.stringToEnumValue(I,t.toUpperCase());return r||console.warn("[zhi-log] LOG_LEVEL is invalid in you .env file.Must be either debug, info, warn or error, fallback to default info level"),r}static getEnvLogger(e){if(e)return e.getEnv(V.LOG_PREFIX_KEY)}}class he{constructor(e,t,r){N(this,"consoleLogger","console"),N(this,"stackSize",1),N(this,"getLogger",l=>{let i;if(l)i=l;else{const u=ge(),d=[];for(let a=0;a<u.length;a++){const E=u[a],f=E.getFileName()??"none";if(!f.includes(".ts")&&!f.includes(".js")&&!f.includes(".cjs")&&!f.includes(".mjs")&&!f.includes(".vue")&&!f.includes(".tsx"))continue;if(a>this.stackSize-1)break;const m=f+"-"+E.getLineNumber()+":"+E.getColumnNumber();d.push(m)}u.length>0&&(i=d.join(" -> "))}return(!i||i.trim().length===0)&&(i=this.consoleLogger),b.getLogger(i)}),this.stackSize=1;let o;e?o=e:o=F.getEnvLevel(r),o=o??I.LOG_LEVEL_INFO,b.setLevel(o);const s={gray:l=>l.toString(),green:l=>l.toString(),yellow:l=>l.toString(),red:l=>l.toString()};R.reg(b),R.apply(b,{format(l,i,u){const d=["["+(t??F.getEnvLogger(r)??"zhi")+"]"];switch(d.push(s.gray("[")+s.green(u).toString()+s.gray("]")),l){case I.LOG_LEVEL_DEBUG:d.push(s.gray(l.toUpperCase().toString()));break;case I.LOG_LEVEL_INFO:d.push(s.green(l.toUpperCase().toString()));break;case I.LOG_LEVEL_WARN:d.push(s.yellow(l.toUpperCase().toString()));break;case I.LOG_LEVEL_ERROR:d.push(s.red(l.toUpperCase().toString()));break}return d.push(s.green(i).toString()),d.push(s.gray(":")),d.join(" ")}})}setStackSize(e){this.stackSize=e??1}}class pe{constructor(e,t,r){N(this,"logger"),this.logger=new he(e,t,r)}getLogger(e,t){return this.logger.setStackSize(t),this.logger.getLogger(e)}}class B extends pe{constructor(e,t,r){super(e,t,r)}getLogger(e,t){return super.getLogger(e,t)}}class H{static defaultLogger(e,t){return H.customLogFactory(void 0,void 0,e).getLogger(void 0,t)}static customLogFactory(e,t,r){return new B(e,t,r)}static customSignLogFactory(e,t){return new B(void 0,e,t)}}class q{}p(q,"LOG_STACK_SIZE",1);class de{constructor(){p(this,"VERSION"),this.VERSION="1.0.0"}}class fe{constructor(){p(this,"VERSION"),this.VERSION="1.0.0"}}const J=class{static isInChromeExtension(){return J.isInBrowser?window.location.href.indexOf("chrome-extension://")>-1:!1}};let A=J;p(A,"isInBrowser",typeof window<"u");class Q{constructor(){p(this,"isInSiyuanOrSiyuanNewWin",()=>A.isInBrowser),p(this,"isInSiyuanWidget",()=>window.frameElement!=null&&window.frameElement.parentElement!=null&&window.frameElement.parentElement.parentElement!=null&&window.frameElement.parentElement.parentElement.getAttribute("data-node-id")!==""),p(this,"isInSiyuanNewWin",()=>typeof window.terwer<"u"),p(this,"requireLib",e=>{const t=this.syWin();if(!this.syWin())throw new Error("Not in siyuan env");return t.require(e)}),p(this,"getCrossPlatformAppDataFolder",()=>{var e,t,r,o,s,l;let i;return((e=this.syProcess())==null?void 0:e.platform)==="darwin"?i=w.join((t=this.syProcess())==null?void 0:t.env.HOME,"/Library/Application Support"):((r=this.syProcess())==null?void 0:r.platform)==="win32"?i=(o=this.syProcess())==null?void 0:o.env.APPDATA:((s=this.syProcess())==null?void 0:s.platform)==="linux"&&(i=(l=this.syProcess())==null?void 0:l.env.HOME),i})}syWin(){let e;return this.isInSiyuanWidget()?e=parent.window:(this.isInSiyuanNewWin()&&(e=window),e=window),e??void 0}syProcess(){return A.isInBrowser?window.process:process}SIYUAN_CONF_PATH(){var e;if(!this.syWin())throw new Error("Not in siyuan env");return(e=this.syWin())==null?void 0:e.siyuan.config.system.confDir}SIYUAN_DATA_PATH(){var e;if(!this.syWin())throw new Error("Not in siyuan env");return(e=this.syWin())==null?void 0:e.siyuan.config.system.dataDir}SIYUAN_APPEARANCE_PATH(){return w.join(this.SIYUAN_CONF_PATH(),"appearance")}SIYUAN_THEME_PATH(){return w.join(this.SIYUAN_APPEARANCE_PATH(),"themes")}ZHI_THEME_PATH(){return w.join(this.SIYUAN_THEME_PATH(),"zhi")}ZHI_THEME_DIST_PATH(){return w.join(this.ZHI_THEME_PATH(),"apps","theme","dist")}ZHI_BLOG_DIST_PATH(){return w.join(this.SIYUAN_THEME_PATH(),"apps","blog","dist")}}class Ee{constructor(){p(this,"serverApi"),p(this,"clientApi"),p(this,"siyuanUtil"),this.serverApi=new de,this.clientApi=new fe,this.siyuanUtil=new Q}}class ve{constructor(){p(this,"VERSION"),this.VERSION="1.0.0"}}class we{f(e,...t){let r=e;for(let o=0;o<t.length;o++){const s=t[o];typeof s=="string"?r=r.replace(`{${o}}`,s):r=r.replace(`{${o}}`,s.toString())}return r}}class ye{copyFolderSync(e,t){const r=this;w.existsSync(t)||w.mkdirSync(t),w.lstatSync(e).isDirectory()&&w.readdirSync(e).forEach(function(o){const s=w.join(e,o);w.lstatSync(s).isDirectory()?r.copyFolderSync(s,w.join(t,o)):w.copyFileSync(s,w.join(t,o))})}rmFolder(e){w.existsSync(e)&&w.rmdirSync(e,{recursive:!0})}joinPath(...e){return w.join(...e)}dirname(e){return w.dirname(e)}absPath(e){const t=this.dirname(e);return w.resolve(w.dirname(t),e)}}class me{constructor(){p(this,"TIME_SPLIT"," "),p(this,"formatIsoToZhDate",(e,t,r)=>{if(!e)return"";let o=e;const s=/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(.\d{3})Z$/gm,l=o.match(s);if(l==null)return e;for(let i=0;i<l.length;i++){const u=l[i];let d=u;t&&(d=this.addHoursToDate(new Date(u),8).toISOString());const a=d.split("T"),E=a[0],f=a[1].split(".")[0];let m=E+this.TIME_SPLIT+f;r&&(m=E),o=o.replace(u,m)}return o})}addHoursToDate(e,t){return e.setTime(e.getTime()+t*60*60*1e3),e}nowZh(){return this.formatIsoToZhDate(new Date().toISOString())}nowDateZh(){return this.formatIsoToZhDate(new Date().toISOString(),!0,!0)}nowTimeZh(){return this.formatIsoToZhDate(new Date().toISOString(),!0).split(this.TIME_SPLIT)[1]}}const j=(n,e)=>{const t=Y(n),r=Y(e),o=t.pop(),s=r.pop(),l=$(t,r);return l!==0?l:o&&s?$(o.split("."),s.split(".")):o||s?o?-1:1:0},Se=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Y=n=>{if(typeof n!="string")throw new TypeError("Invalid argument expected string");const e=n.match(Se);if(!e)throw new Error(`Invalid argument not valid semver ('${n}' received)`);return e.shift(),e},Z=n=>n==="*"||n==="x"||n==="X",K=n=>{const e=parseInt(n,10);return isNaN(e)?n:e},Le=(n,e)=>typeof n!=typeof e?[String(n),String(e)]:[n,e],_e=(n,e)=>{if(Z(n)||Z(e))return 0;const[t,r]=Le(K(n),K(e));return t>r?1:t<r?-1:0},$=(n,e)=>{for(let t=0;t<Math.max(n.length,e.length);t++){const r=_e(n[t]||"0",e[t]||"0");if(r!==0)return r}return 0};class Ie{greater(e,t){return j(e,t)>0}equal(e,t){return j(e,t)===0}lesser(e,t){return j(e,t)<0}}class Oe{static getDevice(){const e=new Q;return e.isInSiyuanWidget()?"Siyuan_Widget":e.isInSiyuanOrSiyuanNewWin()?"Siyuan_NewWin":A.isInChromeExtension()?"Chrome_Extension":"Chrome_Browser"}}class Te{constructor(){p(this,"strUtil"),p(this,"dateUtil"),p(this,"nodeUtil"),p(this,"browserUtil"),p(this,"versionUtil"),p(this,"deviceUtil"),this.strUtil=new we,this.dateUtil=new me,this.nodeUtil=new ye,this.browserUtil=A,this.versionUtil=new Ie,this.deviceUtil=Oe}}class be{constructor(e){p(this,"env"),p(this,"logger"),p(this,"siyuanApi"),p(this,"blogApi"),p(this,"common"),this.env=e,this.logger=H.defaultLogger(this.env,q.LOG_STACK_SIZE),this.siyuanApi=new Ee,this.blogApi=new ve,this.common=new Te}getEnv(){if(!this.env)throw new Error("env is not initiated, please use new ZhiSdk(env) create ZhiSdk object!");return this.env}getLogger(){return this.logger}}function Ne(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ee={};(function(n){var e=Object.defineProperty,t=(l,i,u)=>i in l?e(l,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[i]=u,r=(l,i,u)=>(t(l,typeof i!="symbol"?i+"":i,u),u);Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});class o{}r(o,"NODE_ENV_KEY","NODE_ENV"),r(o,"VITE_DEBUG_MODE_KEY","VITE_DEBUG_MODE");class s{constructor(i){r(this,"envMeta"),this.envMeta=i}isNodeDev(){return this.getEnv(o.NODE_ENV_KEY)==="development"}isDev(){return this.isNodeDev()||this.getBooleanEnv(o.VITE_DEBUG_MODE_KEY)}getEnv(i){let u;try{this.envMeta[i]&&(u=this.envMeta[i])}catch(d){console.error(d)}return u}getStringEnv(i){return this.getEnv(i)??""}getBooleanEnv(i){let u=!1;return this.getEnv(i)&&(u=this.getStringEnv(i).toLowerCase()==="true"),u}getEnvOrDefault(i,u){const d=this.getStringEnv(i);return d.trim().length==0?u:d}}n.EnvConstants=o,n.default=s})(ee);const Ae=Ne(ee),T=class{static zhiSdk(){if(!T.zhiSdkObj){const e=new Ae({VITE_LOG_LEVEL:"DEBUG",VITE_DEBUG_MODE:"true",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1});T.zhiSdkObj=new be(e);const t=T.zhiSdkObj.getLogger(),r=T.zhiSdkObj.common;t.info(r.strUtil.f("ZhiSdk inited, components are available now,like logger, env and so on."))}return T.zhiSdkObj}};let P=T;G(P,"zhiSdkObj");(async()=>{const n=P.zhiSdk(),e=n.getLogger(),t=n.getEnv();e.debug("loglevel=>",t.getStringEnv("VITE_LOG_LEVEL")),e.debug("isNodeDev=>",t.isNodeDev()),e.info("isDev=>",t.isDev());const r=async()=>{e.info("Theme is loading..."),await new oe().init("electron")};t.isDev()?(await import("http://localhost:5173/theme.ts"),await r()):await r()})();
